close all;
clc;
clear;

addpath LPnL-Bar-ENull;
addpath others;
addpath ASPnL;
addpath SRPnL;

T1p1 = [516 239;518 604;109 639;554 228;81 229];
T1p2 = [103 236;521 401;101 238;609 207;8 202];


T1P1_w = [256 256 261;256 25 256;256 10 512;271 256 256;266 256 512];
T1P2_w = [256 256 511;256 155 256;256 255 512;291 256 256;291 256 512];

pointS(1,1:5) = [0, 0, 0, 189.5233426181282, 420.41458544880936];
pointS(2,1:5) = [0, 256, 0, 216.3971427866365, 113.18397391816666];
pointS(3,1:5) = [256, 256, 0, 521.7056626501148, 180.97616082974065];
pointS(4,1:5) = [256, 0, 0, 417.57184587195013, 453.2721780974126];

pointS(5,1:5) = [0, 0, 0, 179.16413834071315, 387.0981022112845];
pointS(6,1:5) = [0, 256, 0, 216.3971427866365, 113.18397391816666];
pointS(7,1:5) = [256, 256, 0, 521.7056626501148, 180.97616082974065];
pointS(8,1:5) = [256, 0, 0, 417.57184587195013, 453.2721780974126];

pointS(9,1:5) = [0, 0, 100, 13.921739362206893, 486.5315479655238];
pointS(10,1:5) = [0, 256, 50, 160.25928833286872, 25.575232001077097];
pointS(11,1:5) = [256, 256, 50, 621.2271544395212, 121.08980650181724];
pointS(12,1:5) = [256, 0, 75, 475.8143239803294, 562.1024683876212];


pointE(1,1:5) = [0, 256, 0, 216.3971427866365, 113.18397391816666];
pointE(2,1:5) = [256, 256, 0, 521.7056626501148, 180.97616082974065];
pointE(3,1:5) = [256, 0, 0, 417.57184587195013, 453.2721780974126];
pointE(4,1:5) = [0, 0, 0, 179.16413834071315, 387.0981022112845];

pointE(5,1:5) = [0, 0, pointS(5,3)+100, 13.921739362206893, 486.5315479655238];
pointE(6,1:5) = [0, 256, pointS(6,3)+100, 160.25928833286872, 25.575232001077097];
pointE(7,1:5) = [256, 256, pointS(7,3)+100, 621.2271544395212, 121.08980650181724];
pointE(8,1:5) = [256, 0, pointS(8,3)+100, 475.8143239803294, 562.1024683876212];

pointE(5,1:5) = [0, 0, 100, 13.921739362206893, 486.5315479655238];
pointE(6,1:5) = [0, 256, 50, 160.25928833286872, 25.575232001077097];
pointE(7,1:5) = [256, 256, 50, 621.2271544395212, 121.08980650181724];
pointE(8,1:5) = [256, 0, 75, 475.8143239803294, 562.1024683876212];


%Type2 Room Camera Pose Estimation

% T1p1 = [516 239;518 604;108 607;554 228;81 229];
% T1p2 = [444 238;521 401;101 238;609 207;8 202];
% 
% 
% T1P1_w = [256 256 261;256 25 256;256 30 512;271 256 256;266 256 512];
% T1P2_w = [256 256 306;256 155 256;256 255 512;291 256 256;291 256 512];


T1A = [[ 197.39816419    0.          320.        ]
 [   0.          197.39816419  320.        ]
 [   0.            0.            1.        ]];

for i = 1:length(T1p1)
    temp1 = inv(T1A)*[T1p1(i,:) 1].';
    temp1 = (temp1/temp1(3)).';
    iT1p1(i,:) = temp1(:,1:2);
    temp2 = inv(T1A)*[T1p2(i,:) 1].';
    temp2 = (temp2/temp2(3)).';
    iT1p2(i,:) = temp2(:,1:2);
end


% [T1R, T1T, T1err] = LPnL_Bar_ENull(iT1p1', iT1p2', T1P1_w', T1P2_w');
% % errorEpln=reprojection_error_usingRT(T1P1_w,T1p1,T1R,T1T,T1A);
% fprintf('error EPnL: %.3f\n',errorEpln);
[T1R1, T1T1] = ASPnL(iT1p1', iT1p2', T1P1_w', T1P2_w');

[T1R2, T1T2,minErr] = SRPnL(iT1p1', iT1p2', T1P1_w', T1P2_w');
%compute error
errorAspnl=reprojection_error_usingRT(T1P1_w,T1p1,T1R1,T1T1,T1A);
fprintf('error Aspnl: %.3f\n',errorAspnl);




