close all;
clc;
clear;

addpath LPnL-Bar-ENull;
addpath others;
addpath RPnL;
addpath SRPnL;
addpath P3Lmethods;
addpath ASPnL;



%Type1 Room Camera Pose Estimation


pointS(1,1:5) =  [0, 256, 0, 307.6591100935348, 233.97973007879574];
pointS(2,1:5) = [0, 256, 0, 307.6591100935348, 233.97973007879574];
pointS(3,1:5) = [0, 256, 0, 307.6591100935348, 233.97973007879574];
% pointS(4,1:5) = [150, 256, 0, 626.9372812064411, 19.50826771415757];
% pointS(5,1:5) = [0, 25, 0, 305.86144048674487, 598.5460711398123];
% pointS(6,1:5) = [0, 256, 125, 57.20467738473769, 45.13290436456816];

pointE(1,1:5) = [150, 256, 0, 626.9372812064411, 19.50826771415757];
pointE(2,1:5) = [0, 25, 0, 305.86144048674487, 598.5460711398123];
pointE(3,1:5) = [0, 256, 125, 57.20467738473769, 45.13290436456816];

% pointE(4,1:5) = [0, 25, 0, 305.86144048674487, 598.5460711398123];
% pointE(5,1:5) = [0, 256, 125, 57.20467738473769, 45.13290436456816];
% pointE(6,1:5) = [150, 256, 0, 626.9372812064411, 19.50826771415757];

% pointE(1,1:5) = [0, 100, 0, 305.86144048674487, 598.5460711398123];
% pointE(2,1:5) = [0, 256, 100, 57.20467738473769, 45.13290436456816];
% pointE(3,1:5) = [100, 256, 0, 626.9372812064411, 19.50826771415757];


p1 = pointS(:,4:5);
p2 = pointE(:,4:5);
P1_w = pointS(:,1:3);
P2_w = pointE(:,1:3);




A = [180 0 320;0 180 320;0   0   1];

for i = 1:length(p1)
    temp1 = inv(A)*[p1(i,:) 1].';
    temp1 = (temp1/temp1(3)).';
    ip1(i,:) = temp1(:,1:2);
    temp2 = inv(A)*[p2(i,:) 1].';
    temp2 = (temp2/temp2(3)).';
    ip2(i,:) = temp2(:,1:2);
end




[T1R1, T1T1, err] = ASPnL(ip1', ip2', P1_w', P2_w');

[T1R2, T1T2,errorRPnL] = RPnL(ip1', ip2', P1_w', P2_w');

% [T1R3, T1T3, err3] = HASPnL(ip1', ip2', P1_w', P2_w',);

[T1R4, T1T4] = SRPnL(ip1', ip2', P1_w', P2_w');

Rs = T1R4(:,:,1);

R_truth = [[ 0.75459463 -0.0131715  -0.65605903]
            [-0.17562487 -0.96737799 -0.18258077]
            [-0.6322522   0.25299475 -0.73229148]];



errR_s = cal_rotation_err(Rs,R_truth);

Ts = T1T4(:,1);

T_truth =[ -7.25394403 173.58293236  90.21832346]

errT_s = cal_translation_err(Ts,T_truth')


[T1R3, T1T3, errs] = WSRPnL(ip1', ip2', p1', p2', P1_w', P2_w');



errorAspnl=reprojection_error_usingRT(P2_w,p2,T1R1,T1T1,A);
fprintf('error Aspnl: %.3f\n',errorAspnl);




