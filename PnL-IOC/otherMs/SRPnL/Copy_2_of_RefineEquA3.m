function [EE,GG,CC] = RefineEquA3(p, W,R,cH,IA,p2d,aPoints)


    pn1 = [p(:,1) p(:,1) p(:,1) p(:,2) p(:,2) p(:,3)];
    pn2 = [p(:,2) p(:,3) p(:,4) p(:,3) p(:,4) p(:,4)];
    n_nc = xcross_mat(pn1,pn2);
    ne_c = xnorm(n_nc);
    Pn1_w = [W(:,1) W(:,1) W(:,1) W(:,2) W(:,2) W(:,3)];
    Pn2_w = [W(:,2) W(:,3) W(:,4) W(:,3) W(:,4) W(:,4)];
 
    neLine = length(pn1);


    Q=zeros(2*neLine,40);
    N=zeros(2*neLine,3);
    for i = 1:3
        nx=ne_c(1,i); ny=ne_c(2,i); nz=ne_c(3,i);
        Px=Pn1_w(1,i); Py=Pn1_w(2,i); Pz=Pn1_w(3,i);
        Q(i,1:10)=[Px.*nx+Py.*ny+Pz.*nz,...    %1
              2*Py.*nz-2*Pz.*ny,...       %s1
              2*Pz.*nx-2*Px.*nz,...       %s2
              2*Px.*ny-2*Py.*nx,...       %s3
              Px.*nx-Py.*ny-Pz.*nz,...     %s1^2
              2.*Px.*ny+2*Py.*nx,...      %s1*s2
              2.*Px.*nz+2*Pz.*nx,...       %s1*s3
              Py.*ny-Px.*nx-Pz.*nz,...     %s2^2
              2*Py.*nz+2*Pz.*ny,...       %s2*s3
              Pz.*nz-Px.*nx-Py.*ny,...     %s3^2
             ];
    end
    
    for i = 4:5
        nx=ne_c(1,i); ny=ne_c(2,i); nz=ne_c(3,i);
        Py=Pn1_w(2,i);Pz=Pn1_w(3,i);
        Q(i,1:18)=[Py.*ny+Pz.*nz,...
              2*Py.*nz-2*Pz.*ny,...
              2*Pz.*nx,...
              -2*Py.*nx,...
              -Py.*ny-Pz.*nz,...
              2*Py.*nx,...
              2*Pz.*nx,...
              Py.*ny-Pz.*nz,...
              2*Py.*nz+2*Pz.*ny,...
              Pz.*nz-Py.*ny,...
              nx,-2*nz,2*ny,nx,2*ny,2*nz,-nx,-nx];
    end
    for i = 6:6
        nx=ne_c(1,i); ny=ne_c(2,i); nz=ne_c(3,i);
        Px=Pn1_w(1,i); Pz=Pn1_w(3,i);
        Q(i,1:26)=[Px.*nx+Pz.*nz,...
              -2*Pz.*ny,...
              2*Pz.*nx-2*Px.*nz,...
              2*Px.*ny,...
              Px.*nx-Pz.*nz,...
              2.*Px.*ny,...
              2.*Px.*nz+2*Pz.*nx,...
              -Px.*nx-Pz.*nz,...
              2*Pz.*ny,...
              Pz.*nz-Px.*nx,...
              0,0,0,0,0,0,0,0,ny,2*nz,-2*nx,-ny,2*nx,ny,2*nz,-ny]; 
    end

    for j = 1:6
        nx=ne_c(1,j); ny=ne_c(2,j); nz=ne_c(3,j);
        if j==1
             Py=Pn2_w(2,j); Pz=Pn2_w(3,j);
             Q(j+6,1:18)=[Py.*ny+Pz.*nz,...
                      2*Py.*nz-2*Pz.*ny,...
                      2*Pz.*nx,...
                      -2*Py.*nx,...
                      -Py.*ny-Pz.*nz,...
                      2*Py.*nx,...
                      2*Pz.*nx,...
                      Py.*ny-Pz.*nz,...
                      2*Py.*nz+2*Pz.*ny,...
                      Pz.*nz-Py.*ny,...
                      nx,-2*nz,2*ny,nx,2*ny,2*nz,-nx,-nx];
        end
        if j==2 || j==4
             Px=Pn2_w(1,j); Pz=Pn2_w(3,j);
             Q(j+6,1:26)=[Px.*nx+Pz.*nz,...
                  -2*Pz.*ny,...
                  2*Pz.*nx-2*Px.*nz,...
                  2*Px.*ny,...
                  Px.*nx-Pz.*nz,...
                  2.*Px.*ny,...
                  2.*Px.*nz+2*Pz.*nx,...
                  -Px.*nx-Pz.*nz,...
                  2*Pz.*ny,...
                  Pz.*nz-Px.*nx,...
                  0,0,0,0,0,0,0,0,ny,2*nz,-2*nx,-ny,2*nx,ny,2*nz,-ny];
        end
        if j==3 || j==5 || j==6
             Px=Pn2_w(1,j); Py=Pn2_w(2,j);
             Q(j+6,1:34)=[Px.*nx+Py.*ny,...
              2*Py.*nz,...
              -2*Px.*nz,...
              2*Px.*ny-2*Py.*nx,...
              Px.*nx-Py.*ny,...
              2.*Px.*ny+2*Py.*nx,...
              2.*Px.*nz,...
              Py.*ny-Px.*nx,...
              2*Py.*nz,...
              -Px.*nx-Py.*ny,...
              0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,nz,-2*ny,2*nx,-nz,2*nx,-nz,2*ny,nz];
        end
    end
    
    N(1:neLine,:)=-ne_c.';
    N(neLine+1:2*neLine,:)=-ne_c.';

    if abs(det(N.'*N)) < 2e-10
        CC=(pinv(N.'*N)*N.')*Q;
    else
        CC=((N.'*N)\N.')*Q;
    end

    EE=Q-N*CC;


    EE(2*neLine+1,:) = [0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0];
    EE(2*neLine+2,:) = [0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0];
    EE(2*neLine+3,:) = [0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0];
    EE(2*neLine+4,:) = [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0];
    EE(2*neLine+5,:) = [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0];
    EE(2*neLine+6,:) = [0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1];
  
    
    
    invR = inv(R);
    
    tempL = zeros(1,40);
    tempL(1) = cH;tempL(5) = cH;tempL(8) = cH;tempL(10) = cH;
    
    EE(2*neLine+7,:) = invR(2,:)*CC + tempL;
    
    numL = 2*neLine+7;
    
    
    solution = Cayley(R);
    
    s1=solution(1); s2=solution(2); s3=solution(3); 
    s4=s1^2; s5=s1*s2; s6=s1*s3;
    s7=s2^2; s8=s2*s3; s9=s3^2;
    s10 = aPoints(1); s11=aPoints(2); s12=aPoints(3);  
    w=[1,s1,s2,s3,s4,s5,s6,s7,s8,s9,...
       s10,s10*s2,s10*s3,s10*s4,s10*s5,s10*s6,s10*s7,s10*s9,...
       s11,s11*s1,s11*s3,s11*s4,s11*s5,s11*s7,s11*s8,s11*s9,...
       s12,s12*s1,s12*s2,s12*s4,s12*s6,s12*s7,s12*s8,s12*s9,...
       s1^2,s1*s2,s1*s3,s2^2,s2*s3,s3^2]';
    fac = 1/(1+s1^2+s2^2+s3^2); 
    T = fac*CC*w;
    
    for i = 1:6
        nx=ne_c(1,i); ny=ne_c(2,i); nz=ne_c(3,i);
        if i == 1
            Px1=Pn1_w(1,i); Py1=Pn1_w(2,i); Pz1=Pn1_w(3,i);
            Py2=Pn2_w(2,i); Pz2=Pn2_w(3,i);
            EE(numL+i,1:18)=[(Px1).*nx+(Py1 - Py2).*ny+(Pz1 - Pz2).*nz,...    %1
                  2*(Py1 - Py2).*nz-2*(Pz1 - Pz2).*ny,...       %s1
                  2*(Pz1 - Pz2).*nx-2*(Px1).*nz,...       %s2
                  2*(Px1).*ny-2*(Py1 - Py2).*nx,...       %s3
                  (Px1).*nx-(Py1 - Py2).*ny-(Pz1 - Pz2).*nz,...     %s1^2
                  2.*(Px1).*ny+2*(Py1 - Py2).*nx,...      %s1*s2
                  2.*(Px1).*nz+2*(Pz1 - Pz2).*nx,...       %s1*s3
                  (Py1 - Py2).*ny-(Px1).*nx-(Pz1 - Pz2).*nz,...     %s2^2
                  2*(Py1 - Py2).*nz+2*(Pz1 - Pz2).*ny,...       %s2*s3
                  (Pz1 - Pz2).*nz-(Px1).*nx-(Py1 - Py2).*ny,...     %s3^2  
                  -nx,2*nz,-2*ny,-nx,-2*ny,-2*nz,nx,nx];
        elseif i == 2
            Px1=Pn1_w(1,i); Py1=Pn1_w(2,i); Pz1=Pn1_w(3,i);
            Px2=Pn2_w(1,i); Pz2=Pn2_w(3,i);
            EE(numL+i,1:26)=[(Px1 - Px2).*nx+(Py1).*ny+(Pz1 - Pz2).*nz,...    %1
                  2*(Py1).*nz-2*(Pz1 - Pz2).*ny,...       %s1
                  2*(Pz1 - Pz2).*nx-2*(Px1 - Px2).*nz,...       %s2
                  2*(Px1 - Px2).*ny-2*(Py1).*nx,...       %s3
                  (Px1 - Px2).*nx-(Py1).*ny-(Pz1 - Pz2).*nz,...     %s1^2
                  2.*(Px1 - Px2).*ny+2*(Py1).*nx,...      %s1*s2
                  2.*(Px1 - Px2).*nz+2*(Pz1 - Pz2).*nx,...       %s1*s3
                  (Py1).*ny-(Px1 - Px2).*nx-(Pz1 - Pz2).*nz,...     %s2^2
                  2*(Py1).*nz+2*(Pz1 - Pz2).*ny,...       %s2*s3
                  (Pz1 - Pz2).*nz-(Px1 - Px2).*nx-(Py1).*ny,...     %s3^2  
                  0,0,0,0,0,0,0,0,-ny,-2*nz,2*nx,ny,-2*nx,-ny,-2*nz,ny
                 ];
        elseif i == 3
            Px1=Pn1_w(1,i); Py1=Pn1_w(2,i); Pz1=Pn1_w(3,i);
            Px2=Pn2_w(1,i); Py2=Pn2_w(2,i);
            EE(numL+i,1:34)=[(Px1 - Px2).*nx+(Py1 - Py2).*ny+(Pz1).*nz,...    %1
                  2*(Py1 - Py2).*nz-2*(Pz1).*ny,...       %s1
                  2*(Pz1).*nx-2*(Px1 - Px2).*nz,...       %s2
                  2*(Px1 - Px2).*ny-2*(Py1 - Py2).*nx,...       %s3
                  (Px1 - Px2).*nx-(Py1 - Py2).*ny-(Pz1).*nz,...     %s1^2
                  2.*(Px1 - Px2).*ny+2*(Py1 - Py2).*nx,...      %s1*s2
                  2.*(Px1 - Px2).*nz+2*(Pz1).*nx,...       %s1*s3
                  (Py1 - Py2).*ny-(Px1 - Px2).*nx-(Pz1).*nz,...     %s2^2
                  2*(Py1 - Py2).*nz+2*(Pz1).*ny,...       %s2*s3
                  (Pz1).*nz-(Px1 - Px2).*nx-(Py1 - Py2).*ny,...     %s3^2  
                  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-nz,2*ny,-2*nx,nz,-2*nx,nz,-2*ny,-nz
                 ];
        elseif i == 4
            Py1=Pn1_w(2,i); Pz1=Pn1_w(3,i);
            Px2=Pn2_w(1,i); Pz2=Pn2_w(3,i);
            EE(numL+i,1:26)=[(-Px2).*nx+(Py1).*ny+(Pz1 - Pz2).*nz,...    %1
                  2*(Py1).*nz-2*(Pz1 - Pz2).*ny,...       %s1
                  2*(Pz1 - Pz2).*nx-2*(-Px2).*nz,...       %s2
                  2*(-Px2).*ny-2*(Py1).*nx,...       %s3
                  (-Px2).*nx-(Py1).*ny-(Pz1 - Pz2).*nz,...     %s1^2
                  2.*(-Px2).*ny+2*(Py1).*nx,...      %s1*s2
                  2.*(-Px2).*nz+2*(Pz1 - Pz2).*nx,...       %s1*s3
                  (Py1).*ny-(-Px2).*nx-(Pz1 - Pz2).*nz,...     %s2^2
                  2*(Py1).*nz+2*(Pz1 - Pz2).*ny,...       %s2*s3
                  (Pz1 - Pz2).*nz-(-Px2).*nx-(Py1).*ny,...     %s3^2  
                  nx,-2*nz,2*ny,nx,2*ny,2*nz,-nx,-nx,-ny,-2*nz,2*nx,ny,-2*nx,-ny,-2*nz,ny
                 ];
        elseif i == 5
            Py1=Pn1_w(2,i); Pz1=Pn1_w(3,i);
            Px2=Pn2_w(1,i); Py2=Pn2_w(2,i);
            EE(numL+i,1:34)=[(-Px2).*nx+(Py1 - Py2).*ny+(Pz1).*nz,...    %1
                  2*(Py1 - Py2).*nz-2*(Pz1).*ny,...       %s1
                  2*(Pz1).*nx-2*(-Px2).*nz,...       %s2
                  2*(-Px2).*ny-2*(Py1 - Py2).*nx,...       %s3
                  (-Px2).*nx-(Py1 - Py2).*ny-(Pz1).*nz,...     %s1^2
                  2.*(-Px2).*ny+2*(Py1 - Py2).*nx,...      %s1*s2
                  2.*(-Px2).*nz+2*(Pz1).*nx,...       %s1*s3
                  (Py1 - Py2).*ny-(-Px2).*nx-(Pz1).*nz,...     %s2^2
                  2*(Py1 - Py2).*nz+2*(Pz1).*ny,...       %s2*s3
                  (Pz1).*nz-(-Px2).*nx-(Py1 - Py2).*ny,...     %s3^2  
                  nx,-2*nz,2*ny,nx,2*ny,2*nz,-nx,-nx,0,0,0,0,0,0,0,0,-nz,2*ny,-2*nx,nz,-2*nx,nz,-2*ny,-nz
                 ];
        elseif i == 6
            Px1=Pn1_w(1,i); Pz1=Pn1_w(3,i);
            Px2=Pn2_w(1,i); Py2=Pn2_w(2,i);
            EE(numL+i,1:34)=[(Px1 - Px2).*nx+(-Py2).*ny+(Pz1).*nz,...    %1
                  2*(-Py2).*nz-2*(Pz1).*ny,...       %s1
                  2*(Pz1).*nx-2*(Px1 - Px2).*nz,...       %s2
                  2*(Px1 - Px2).*ny-2*(-Py2).*nx,...       %s3
                  (Px1 - Px2).*nx-(-Py2).*ny-(Pz1).*nz,...     %s1^2
                  2.*(Px1 - Px2).*ny+2*(-Py2).*nx,...      %s1*s2
                  2.*(Px1 - Px2).*nz+2*(Pz1).*nx,...       %s1*s3
                  (-Py2).*ny-(Px1 - Px2).*nx-(Pz1).*nz,...     %s2^2
                  2*(-Py2).*nz+2*(Pz1).*ny,...       %s2*s3
                  (Pz1).*nz-(Px1 - Px2).*nx-(-Py2).*ny,...     %s3^2  
                  0,0,0,0,0,0,0,0,ny,2*nz,-2*nx,-ny,2*nx,ny,2*nz,-ny,-nz,2*ny,-2*nx,nz,-2*nx,nz,-2*ny,-nz
                 ];
        end
    end
    
    f = IA(1,1);
    u0 = IA(1,3);
    v0 = IA(2,3);
    
    [~,pno] = size(W);
    
    numL = 2*neLine+13;
    
    
    for i = 1:pno
        switch i
            case 1
                u = p2d(i,1);v = p2d(i,2);
                X = W(1,i);Y = W(2,i);Z = W(3,i);
                EE(numL+2*i-1,1:34) = [f*CC(1,1)+(u0-u)*CC(3,1)+f*X+(u0-u)*Z,...
                                       f*CC(1,2)+(u0-u)*CC(3,2)+2*(u0-u)*Y,...
                                       f*CC(1,3)+(u0-u)*CC(3,3)-2*(u0-u)*X+2*f*Z,...
                                       f*CC(1,4)+(u0-u)*CC(3,4)-2*f*Y,...
                                       f*CC(1,5)+(u0-u)*CC(3,5)+f*X-(u0-u)*Z,...
                                       f*CC(1,6)+(u0-u)*CC(3,6)+2*f*Y,...
                                       f*CC(1,7)+(u0-u)*CC(3,7)+2*(u0-u)*X+2*f*Z,...
                                       f*CC(1,8)+(u0-u)*CC(3,8)-f*X-(u0-u)*Z,...
                                       f*CC(1,9)+(u0-u)*CC(3,9)+2*(u0-u)*Y,...
                                       f*CC(1,10)+(u0-u)*CC(3,10)-f*X+(u0-u)*Z,...
                                       f*CC(1,11:34)+(u0-u)*CC(3,11:34) 
                                       ];
                EE(numL+2*i,1:34) = [f*CC(2,1)+(v0-v)*CC(3,1)+f*Y+(v0-v)*Z,...
                                       f*CC(2,2)+(v0-v)*CC(3,2)+2*(v0-v)*Y-2*f*Z,...
                                       f*CC(2,3)+(v0-v)*CC(3,3)-2*(v0-v)*X,...
                                       f*CC(2,4)+(v0-v)*CC(3,4)+2*f*X,...
                                       f*CC(2,5)+(v0-v)*CC(3,5)-f*Y-(v0-v)*Z,...
                                       f*CC(2,6)+(v0-v)*CC(3,6)+2*f*X,...
                                       f*CC(2,7)+(v0-v)*CC(3,7)+2*(v0-v)*X,...
                                       f*CC(2,8)+(v0-v)*CC(3,8)+f*Y-(v0-v)*Z,...
                                       f*CC(2,9)+(v0-v)*CC(3,9)+2*(v0-v)*Y+2*f*Z,...
                                       f*CC(2,10)+(v0-v)*CC(3,10)-f*Y+(v0-v)*Z,...
                                       f*CC(2,11:34)+(v0-v)*CC(3,11:34)
                                       ];
            case 2
                u = p2d(i,1);v = p2d(i,2);
                Y = W(2,i);Z = W(3,i);
                EE(numL+2*i-1,1:34) = [f*CC(1,1)+(u0-u)*CC(3,1)+(u0-u)*Z,...
                                       f*CC(1,2)+(u0-u)*CC(3,2)+2*(u0-u)*Y,...
                                       f*CC(1,3)+(u0-u)*CC(3,3)+2*f*Z,...
                                       f*CC(1,4)+(u0-u)*CC(3,4)-2*f*Y,...
                                       f*CC(1,5)+(u0-u)*CC(3,5)-(u0-u)*Z,...
                                       f*CC(1,6)+(u0-u)*CC(3,6)+2*f*Y,...
                                       f*CC(1,7)+(u0-u)*CC(3,7)+2*f*Z,...
                                       f*CC(1,8)+(u0-u)*CC(3,8)-(u0-u)*Z,...
                                       f*CC(1,9)+(u0-u)*CC(3,9)+2*(u0-u)*Y,...
                                       f*CC(1,10)+(u0-u)*CC(3,10)+(u0-u)*Z,...
                                       f+f*CC(1,11)+(u0-u)*CC(3,11),...
                                       -2*(u0-u)+f*CC(1,12)+(u0-u)*CC(3,12),...
                                       f*CC(1,13)+(u0-u)*CC(3,13),...
                                       f+f*CC(1,14)+(u0-u)*CC(3,14),...
                                       f*CC(1,15)+(u0-u)*CC(3,15),...
                                       2*(u0-u)+f*CC(1,16)+(u0-u)*CC(3,16),...
                                       -f+f*CC(1,17)+(u0-u)*CC(3,17),...
                                       -f+f*CC(1,18)+(u0-u)*CC(3,18),...
                                       f*CC(1,19:34)+(u0-u)*CC(3,19:34) 
                                       ];
                EE(numL+2*i,1:34) = [f*CC(2,1)+(v0-v)*CC(3,1)+f*Y+(v0-v)*Z,...
                                       f*CC(2,2)+(v0-v)*CC(3,2)+2*(v0-v)*Y-2*f*Z,...
                                       f*CC(2,3)+(v0-v)*CC(3,3),...
                                       f*CC(2,4)+(v0-v)*CC(3,4),...
                                       f*CC(2,5)+(v0-v)*CC(3,5)-f*Y-(v0-v)*Z,...
                                       f*CC(2,6)+(v0-v)*CC(3,6),...
                                       f*CC(2,7)+(v0-v)*CC(3,7),...
                                       f*CC(2,8)+(v0-v)*CC(3,8)+f*Y-(v0-v)*Z,...
                                       f*CC(2,9)+(v0-v)*CC(3,9)+2*(v0-v)*Y+2*f*Z,...
                                       f*CC(2,10)+(v0-v)*CC(3,10)-f*Y+(v0-v)*Z,...
                                       f*CC(2,11)+(v0-v)*CC(3,11),...
                                       -2*(v0-v)+f*CC(2,12)+(v0-v)*CC(3,12),...
                                       2*f+f*CC(2,13)+(v0-v)*CC(3,13),...
                                       f*CC(2,14)+(v0-v)*CC(3,14),...
                                       2*f+f*CC(2,15)+(v0-v)*CC(3,15),...
                                       2*(v0-v)+f*CC(2,16)+(v0-v)*CC(3,16),...
                                       f*CC(2,17)+(v0-v)*CC(3,17),...
                                       f*CC(2,18)+(v0-v)*CC(3,18),...
                                       f*CC(2,19:34)+(v0-v)*CC(3,19:34)
                                       ];
            case 3
                u = p2d(i,1);v = p2d(i,2);
                X = W(1,i);Z = W(3,i);
                EE(numL+2*i-1,1:34) = [f*CC(1,1)+(u0-u)*CC(3,1)+f*X+(u0-u)*Z,...
                                       f*CC(1,2)+(u0-u)*CC(3,2),...
                                       f*CC(1,3)+(u0-u)*CC(3,3)-2*(u0-u)*X+2*f*Z,...
                                       f*CC(1,4)+(u0-u)*CC(3,4),...
                                       f*CC(1,5)+(u0-u)*CC(3,5)+f*X-(u0-u)*Z,...
                                       f*CC(1,6)+(u0-u)*CC(3,6),...
                                       f*CC(1,7)+(u0-u)*CC(3,7)+2*(u0-u)*X+2*f*Z,...
                                       f*CC(1,8)+(u0-u)*CC(3,8)-f*X-(u0-u)*Z,...
                                       f*CC(1,9)+(u0-u)*CC(3,9),...
                                       f*CC(1,10)+(u0-u)*CC(3,10)-f*X+(u0-u)*Z,...
                                       f*CC(1,11:18)+(u0-u)*CC(3,11:18),...
                                       f*CC(1,19)+(u0-u)*CC(3,19),...
                                       2*(u0-u)+f*CC(1,20)+(u0-u)*CC(3,20),...
                                       -2*f+f*CC(1,21)+(u0-u)*CC(3,21),...
                                       f*CC(1,22)+(u0-u)*CC(3,22),...
                                       2*f+f*CC(1,23)+(u0-u)*CC(3,23),...
                                       f*CC(1,24)+(u0-u)*CC(3,24),...
                                       2*(u0-u)+f*CC(1,25)+(u0-u)*CC(3,25),...
                                       f*CC(1,26)+(u0-u)*CC(3,26),...
                                       f*CC(1,27:34)+(u0-u)*CC(3,27:34)
                                       ];
                EE(numL+2*i,1:34) = [f*CC(2,1)+(v0-v)*CC(3,1)+(v0-v)*Z,...
                                       f*CC(2,2)+(v0-v)*CC(3,2)-2*f*Z,...
                                       f*CC(2,3)+(v0-v)*CC(3,3)-2*(v0-v)*X,...
                                       f*CC(2,4)+(v0-v)*CC(3,4)+2*f*X,...
                                       f*CC(2,5)+(v0-v)*CC(3,5)-(v0-v)*Z,...
                                       f*CC(2,6)+(v0-v)*CC(3,6)+2*f*X,...
                                       f*CC(2,7)+(v0-v)*CC(3,7)+2*(v0-v)*X,...
                                       f*CC(2,8)+(v0-v)*CC(3,8)-(v0-v)*Z,...
                                       f*CC(2,9)+(v0-v)*CC(3,9)+2*f*Z,...
                                       f*CC(2,10)+(v0-v)*CC(3,10)+(v0-v)*Z,...
                                       f*CC(2,11:18)+(v0-v)*CC(3,11:18),...
                                       f+f*CC(2,19)+(v0-v)*CC(3,19),...
                                       2*(v0-v)+f*CC(2,20)+(v0-v)*CC(3,20),...
                                       f*CC(2,21)+(v0-v)*CC(3,21),...
                                       -f+f*CC(2,22)+(v0-v)*CC(3,22),...
                                       f*CC(2,23)+(v0-v)*CC(3,23),...
                                       f+f*CC(2,24)+(v0-v)*CC(3,24),...
                                       2*(v0-v)+f*CC(2,25)+(v0-v)*CC(3,25),...
                                       -f+f*CC(2,26)+(v0-v)*CC(3,26),...
                                       f*CC(2,27:34)+(v0-v)*CC(3,27:34)
                                       ];
            otherwise
                u = p2d(i,1);v = p2d(i,2);
                X = W(1,i);Y = W(2,i);
                EE(numL+2*i-1,1:34) = [f*CC(1,1)+(u0-u)*CC(3,1)+f*X,...
                                       f*CC(1,2)+(u0-u)*CC(3,2)+2*(u0-u)*Y,...
                                       f*CC(1,3)+(u0-u)*CC(3,3)-2*(u0-u)*X,...
                                       f*CC(1,4)+(u0-u)*CC(3,4)-2*f*Y,...
                                       f*CC(1,5)+(u0-u)*CC(3,5)+f*X,...
                                       f*CC(1,6)+(u0-u)*CC(3,6)+2*f*Y,...
                                       f*CC(1,7)+(u0-u)*CC(3,7)+2*(u0-u)*X,...
                                       f*CC(1,8)+(u0-u)*CC(3,8)-f*X,...
                                       f*CC(1,9)+(u0-u)*CC(3,9)+2*(u0-u)*Y,...
                                       f*CC(1,10)+(u0-u)*CC(3,10)-f*X,...
                                       f*CC(1,11:26)+(u0-u)*CC(3,11:26),...
                                       (u0-u)+f*CC(1,27)+(u0-u)*CC(3,27),...
                                       f*CC(1,28)+(u0-u)*CC(3,28),...
                                       2*f+f*CC(1,29)+(u0-u)*CC(3,29),...
                                       -(u0-u)+f*CC(1,30)+(u0-u)*CC(3,30),...
                                       2*f+f*CC(1,31)+(u0-u)*CC(3,31),...
                                       -(u0-u)+f*CC(1,32)+(u0-u)*CC(3,32),...
                                       f*CC(1,33)+(u0-u)*CC(3,33),...
                                       (u0-u)+f*CC(1,34)+(u0-u)*CC(3,34)
                                       ];
                EE(numL+2*i,1:34) = [f*CC(2,1)+(v0-v)*CC(3,1)+f*Y,...
                                       f*CC(2,2)+(v0-v)*CC(3,2)+2*(v0-v)*Y,...
                                       f*CC(2,3)+(v0-v)*CC(3,3)-2*(v0-v)*X,...
                                       f*CC(2,4)+(v0-v)*CC(3,4)+2*f*X,...
                                       f*CC(2,5)+(v0-v)*CC(3,5)-f*Y,...
                                       f*CC(2,6)+(v0-v)*CC(3,6)+2*f*X,...
                                       f*CC(2,7)+(v0-v)*CC(3,7)+2*(v0-v)*X,...
                                       f*CC(2,8)+(v0-v)*CC(3,8)+f*Y,...
                                       f*CC(2,9)+(v0-v)*CC(3,9)+2*(v0-v)*Y,...
                                       f*CC(2,10)+(v0-v)*CC(3,10)-f*Y,...
                                       f*CC(2,11:26)+(v0-v)*CC(3,11:26),...
                                       (v0-v)+f*CC(2,27)+(v0-v)*CC(3,27),...
                                       -2*f+f*CC(2,28)+(v0-v)*CC(3,28),...
                                       f*CC(2,29)+(v0-v)*CC(3,29),...
                                       -(v0-v)+f*CC(2,30)+(v0-v)*CC(3,30),...
                                       f*CC(2,31)+(v0-v)*CC(3,31),...
                                       -(v0-v)+f*CC(2,32)+(v0-v)*CC(3,32),...
                                       2*f+f*CC(2,33)+(v0-v)*CC(3,33),...
                                       (v0-v)+f*CC(2,34)+(v0-v)*CC(3,34)
                                       ];
        end   
    end
    

    GG=EE.'*EE;
    
end
