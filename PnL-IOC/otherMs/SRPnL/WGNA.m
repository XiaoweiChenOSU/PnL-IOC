function [R, t, err] = WGNA(xs, xe, Pn1_w, Pn2_w, R0)

%first compute the weight of each line and the normal of the interpretation plane passing through to camera center and the line 
s0 = [CGR(R0);Pn2_w(1,1);Pn2_w(2,2);Pn2_w(3,3)];

npart = 3;  
neLine = length(xs);
ne_c=xnorm(cross(xs,xe));

Q=zeros(2*neLine,34);
N=zeros(2*neLine,3);
nx=ne_c(1,1:npart)'; ny=ne_c(2,1:npart)'; nz=ne_c(3,1:npart)';
Px=Pn1_w(1,1:npart)'; Py=Pn1_w(2,1:npart)'; Pz=Pn1_w(3,1:npart)';
Q(1:2:2*npart,:)=[Px.*nx+Py.*ny+Pz.*nz,...    %1
          2*Py.*nz-2*Pz.*ny,...       %s1
          2*Pz.*nx-2*Px.*nz,...       %s2
          2*Px.*ny-2*Py.*nx,...       %s3
          Px.*nx-Py.*ny-Pz.*nz,...     %s1^2
          2.*Px.*ny+2*Py.*nx,...      %s1*s2
          2.*Px.*nz+2*Pz.*nx,...       %s1*s3
          Py.*ny-Px.*nx-Pz.*nz,...     %s2^2
          2*Py.*nz+2*Pz.*ny,...       %s2*s3
          Pz.*nz-Px.*nx-Py.*ny,...     %s3^2
          [0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0],[0;0;0]];
nx=ne_c(1,1)'; ny=ne_c(2,1)'; nz=ne_c(3,1)';      
Py=Pn2_w(2,1)'; Pz=Pn2_w(3,1)';
Q(2,:)=[Py.*ny+Pz.*nz,...
          2*Py.*nz-2*Pz.*ny,...
          2*Pz.*nx,...
          -2*Py.*nx,...
          -Py.*ny-Pz.*nz,...
          2*Py.*nx,...
          2*Pz.*nx,...
          Py.*ny-Pz.*nz,...
          2*Py.*nz+2*Pz.*ny,...
          Pz.*nz-Py.*ny,...
          nx,-2*nz,2*ny,nx,2*ny,2*nz,-nx,-nx,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
nx=ne_c(1,2)'; ny=ne_c(2,2)'; nz=ne_c(3,2)';
Px=Pn2_w(1,2)'; Pz=Pn2_w(3,2)';
Q(4,:)=[Px.*nx+Pz.*nz,...
          -2*Pz.*ny,...
          2*Pz.*nx-2*Px.*nz,...
          2*Px.*ny,...
          Px.*nx-Pz.*nz,...
          2.*Px.*ny,...
          2.*Px.*nz+2*Pz.*nx,...
          -Px.*nx-Pz.*nz,...
          2*Pz.*ny,...
          Pz.*nz-Px.*nx,...
          0,0,0,0,0,0,0,0,ny,2*nz,-2*nx,-ny,2*nx,ny,2*nz,-ny,0,0,0,0,0,0,0,0];  
nx=ne_c(1,3)'; ny=ne_c(2,3)'; nz=ne_c(3,3)';
Px=Pn2_w(1,3)'; Py=Pn2_w(2,3)';
Q(6,:)=[Px.*nx+Py.*ny,...
          2*Py.*nz,...
          -2*Px.*nz,...
          2*Px.*ny-2*Py.*nx,...
          Px.*nx-Py.*ny,...
          2.*Px.*ny+2*Py.*nx,...
          2.*Px.*nz,...
          Py.*ny-Px.*nx,...
          2*Py.*nz,...
          -Px.*nx-Py.*ny,...
          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, nz,-2*ny,2*nx,-nz,2*nx,-nz,2*ny,nz];


nx=ne_c(1,4)'; ny=ne_c(2,4)'; nz=ne_c(3,4)';      
Py=Pn1_w(2,4)'; Pz=Pn1_w(3,4)';
Q(7,:)=[Py.*ny+Pz.*nz,...
          2*Py.*nz-2*Pz.*ny,...
          2*Pz.*nx,...
          -2*Py.*nx,...
          -Py.*ny-Pz.*nz,...
          2*Py.*nx,...
          2*Pz.*nx,...
          Py.*ny-Pz.*nz,...
          2*Py.*nz+2*Pz.*ny,...
          Pz.*nz-Py.*ny,...
          nx,-2*nz,2*ny,nx,2*ny,2*nz,-nx,-nx,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
Px=Pn2_w(1,4)'; Pz=Pn2_w(3,4)';
Q(8,:)=[Px.*nx+Pz.*nz,...
          -2*Pz.*ny,...
          2*Pz.*nx-2*Px.*nz,...
          2*Px.*ny,...
          Px.*nx-Pz.*nz,...
          2.*Px.*ny,...
          2.*Px.*nz+2*Pz.*nx,...
          -Px.*nx-Pz.*nz,...
          2*Pz.*ny,...
          Pz.*nz-Px.*nx,...
          0,0,0,0,0,0,0,0,   ny,2*nz,-2*nx,-ny,2*nx,ny,2*nz,-ny,0,0,0,0,0,0,0,0];        

nx=ne_c(1,5)'; ny=ne_c(2,5)'; nz=ne_c(3,5)';      
Px=Pn1_w(1,5)'; Pz=Pn1_w(3,5)';
Q(9,:)=[Px.*nx+Pz.*nz,...
          -2*Pz.*ny,...
          2*Pz.*nx-2*Px.*nz,...
          2*Px.*ny,...
          Px.*nx-Pz.*nz,...
          2.*Px.*ny,...
          2.*Px.*nz+2*Pz.*nx,...
          -Px.*nx-Pz.*nz,...
          2*Pz.*ny,...
          Pz.*nz-Px.*nx,...
          0,0,0,0,0,0,0,0,   ny,2*nz,-2*nx,-ny,2*nx,ny,2*nz,-ny,0,0,0,0,0,0,0,0];        
Px=Pn2_w(1,5)'; Py=Pn2_w(2,5)';
Q(10,:)=[Px.*nx+Py.*ny,...
          2*Py.*nz,...
          -2*Px.*nz,...
          2*Px.*ny-2*Py.*nx,...
          Px.*nx-Py.*ny,...
          2.*Px.*ny+2*Py.*nx,...
          2.*Px.*nz,...
          Py.*ny-Px.*nx,...
          2*Py.*nz,...
          -Px.*nx-Py.*ny,...
          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, nz,-2*ny,2*nx,-nz,2*nx,-nz,2*ny,nz];

nx=ne_c(1,6)'; ny=ne_c(2,6)'; nz=ne_c(3,6)';      
Px=Pn1_w(1,6)'; Py=Pn1_w(2,6)';
Q(11,:)=[Px.*nx+Py.*ny,...
          2*Py.*nz,...
          -2*Px.*nz,...
          2*Px.*ny-2*Py.*nx,...
          Px.*nx-Py.*ny,...
          2.*Px.*ny+2*Py.*nx,...
          2.*Px.*nz,...
          Py.*ny-Px.*nx,...
          2*Py.*nz,...
          -Px.*nx-Py.*ny,...
          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, nz,-2*ny,2*nx,-nz,2*nx,-nz,2*ny,nz];
Py=Pn2_w(2,6)'; Pz=Pn2_w(3,6)';
Q(12,:)=[Py.*ny+Pz.*nz,...
          2*Py.*nz-2*Pz.*ny,...
          2*Pz.*nx,...
          -2*Py.*nx,...
          -Py.*ny-Pz.*nz,...
          2*Py.*nx,...
          2*Pz.*nx,...
          Py.*ny-Pz.*nz,...
          2*Py.*nz+2*Pz.*ny,...
          Pz.*nz-Py.*ny,...
          nx,-2*nz,2*ny,nx,2*ny,2*nz,-nx,-nx,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];

N(1:2:2*neLine,:)=-ne_c.';
N(2:2:2*neLine,:)=-ne_c.';

if abs(det(N.'*N)) < 2e-10
    CC=(pinv(N.'*N)*N.')*Q;
else
    CC=((N.'*N)\N.')*Q;
end

EE=Q-N*CC;
GG=EE.'*EE;


s= GaussNewton(GG,s0);

R= CGR2(s(1:3));
x = R(:);
t= A4*x;

err = x' * M * x;

return

function c = xcross(a,b)

c = [a(2)*b(3)-a(3)*b(2);
     a(3)*b(1)-a(1)*b(3);
     a(1)*b(2)-a(2)*b(1)];
 
return
 
function s= CGR(R)

A= R.';

q4= sqrt(1+A(1,1)+A(2,2)+A(3,3))/2;

if q4 > 0.01
	q1= (A(3,2)-A(2,3))/q4/4;
	q2= (A(1,3)-A(3,1))/q4/4;
	q3= (A(2,1)-A(1,2))/q4/4;
else
	q1= sqrt(1+A(1,1)-A(2,2)-A(3,3))/2;
	q2= (A(1,2)+A(2,1))/q1/4;
	q3= (A(1,3)+A(3,1))/q1/4;
	q4= (A(3,2)-A(2,3))/q1/4;
end

s= -[q1; q2; q3]/q4;

return

function R= CGR2(s)

s1= s(1);
s2= s(2);
s3= s(3);

R= [1+s1^2-s2^2-s3^2,   2*s1*s2-2*s3,   2*s2+2*s1*s3;
    2*s3+2*s1*s2,   1-s1^2+s2^2-s3^2,   2*s2*s3-2*s1;
    2*s1*s3-2*s2,   2*s1+2*s2*s3,   1-s1^2-s2^2+s3^2];
 
R= R/(1+s1*s1+s2*s2+s3*s3);

return

function s= GaussNewton(m,s0)

A1= [...
0;
0;
0;
2*m(14) + 2*m(48) + 2*m(82)+ 2*m(116)+ 2*m(150) + 2*m(184) + 2*m(218) + 2*m(252) + 2*m(286) + 2*m(320) + 2*m(354) + 2*m(388) + 2*m(422) + 2*m(456) + 2*m(490) + 2*m(524) + 2*m(558) + 2*m(592) + 2*m(626) + 2*m(660) + 2*m(694) + 2*m(728) + 2*m(762) + 2*m(796) + 2*m(830) + 2*m(864) + 2*m(898) + 2*m(932) + 2*m(966) + 2*m(1000) + 2*m(1034) + 2*m(1068) + 2*m(1102) + 2*m(1136);
2*m(22) + 2*m(56) + 2*m(90) + 2*m(124) + 2*m(158) + 2*m(192) + 2*m(226) + 2*m(260) + 2*m(294) + 2*m(328) + 2*m(362) + 2*m(396) + 2*m(430) + 2*m(464) + 2*m(498) + 2*m(532) + 2*m(566) + 2*m(600) + 2*m(634) + 2*m(668) + 2*m(702) + 2*m(736) + 2*m(770 ) + 2*m(804) + 2*m(838) + 2*m(872) + 2*m(906) + 2*m(940) + 2*m(974) + 2*m(1008) + 2*m(1042) + 2*m(1076) + 2*m(1110) + 2*m(1144);
2*m(30) + 2*m(64) + 2*m(98) + 2*m(132) + 2*m(166) + 2*m(200) + 2*m(234) + 2*m(268) + 2*m(302) + 2*m(336) + 2*m(370) + 2*m(404) + 2*m(438) + 2*m(472) + 2*m(506) + 2*m(540) + 2*m(574) + 2*m(608) + 2*m(642) + 2*m(676) + 2*m(710) + 2*m(744) + 2*m(778) + 2*m(812) + 2*m(846) + 2*m(880) + 2*m(914) + 2*m(948) + 2*m(982) + 2*m(1016)+ 2*m(1050) + 2*m(1084)+ 2*m(1118) + 2*m(1152);
2*m(5) + 2*m(39) + 2*m(73) + 2*m(107) + 2*m(141) + 2*m(175) + 2*m(209) + 2*m(243) + 2*m(277)+ 2*m(311) + 2*m(345) + 2*m(379) + 2*m(413) + 2*m(447) + 2*m(481) + 2*m(515) + 2*m(549) + 2*m(583) + 2*m(617) + 2*m(651) + 2*m(685) + 2*m(719) + 2*m(753) + 2*m(787) + 2*m(821)+ 2*m(855)+ 2*m(889)+ 2*m(923)+ 2*m(957)+ 2*m(991)+ 2*m(1025)+ 2*m(1059)+ 2*m(1093)+ 2*m(1127);
0;
0;
m(15)+ m(49)+ m(83)+ m(117)+ m(151)+ m(185)+ m(219)+ m(253)+ m(287)+ m(321)+ m(355)+ m(389)+ m(423)+ m(457)+ m(491)+ m(525)+ m(559)+ m(593)+ m(627)+ m(661)+ m(695)+ m(729)+ m(763)+ m(797)+ m(831)+ m(865)+ m(899)+ m(933)+ m(967)+ m(1001)+ m(1035)+ m(1069)+ m(1103)+ m(1137);
m(23)+ m(57)+ m(91)+ m(125)+ m(159)+ m(193)+ m(227)+ m(261)+ m(295)+ m(329)+ m(363)+ m(397)+ m(431)+ m(465)+ m(499)+ m(533)+ m(567)+ m(601)+ m(635)+ m(669)+ m(703)+ m(737)+ m(771)+ m(805)+ m(839)+ m(873)+ m(907)+ m(941)+ m(975)+ m(1009)+ m(1043)+ m(1077)+ m(1111)+ m(1145);
0;
m(6) + m(40) + m(74) + m(108) + m(142) + m(176) + m(210) + m(244) + m(278) + m(312) + m(346) + m(380) + m(414) + m(448) + m(482) + m(516) + m(550) + m(584) + m(618) + m(652) + m(686) + m(720) + m(754) + m(788) + m(822) + m(856) + m(890) + m(924) + m(958) + m(992) + m(1026) + m(1060) + m(1094) + m(1128);
0;
m(16) + m(50) + m(84) + m(118) + m(152) + m(186) + m(220) + m(254) + m(288) + m(322) + m(356) + m(390) + m(424) + m(458) + m(492) + m(526) + m(560) + m(594) + m(628) + m(662) + m(696) + m(730) + m(764) + m(798) + m(832) + m(866) + m(900) + m(934) + m(968) + m(1002) + m(1036) + m(1070) + m(1104) + m(1138);
0;
m(31) + m(65) + m(99) + m(133) + m(167) + m(201) + m(235) + m(269) + m(303) + m(337) + m(371) + m(405) + m(439) + m(473) + m(507) + m(541) + m(575) + m(609) + m(643) + m(677) + m(711) + m(745) + m(779) + m(813) + m(847) + m(881) + m(915) + m(949) + m(983) + m(1017) + m(1051) + m(1085) + m(1119) + m(1153);
m(7) + m(41) + m(75) + m(109) + m(143) + m(177) + m(211) + m(245) + m(279) + m(313) + m(347) + m(381) + m(415) + m(449) + m(483) + m(517) + m(551) + m(585) + m(619) + m(653) + m(687) + m(721) + m(755) + m(789) + m(823) + m(857) + m(891) + m(925) + m(959) + m(993) + m(1027) + m(1061) + m(1095) + m(1129);
0;
m(20) + m(54) + m(88) + m(122) + m(156) + m(190) + m(224) + m(258) + m(292) + m(326) + m(360) + m(394) + m(428) + m(462) + m(496) + m(530) + m(564) + m(598) + m(632) + m(666) + m(700) + m(734) + m(768) + m(802) + m(836) + m(870) + m(904) + m(938) + m(972) + m(1006) + m(1040) + m(1074) + m(1108) + m(1142);
m(28) + m(62) + m(96) + m(130) + m(164) + m(198) + m(232) + m(266) + m(300) + m(334) + m(368) + m(402) + m(436) + m(470) + m(504) + m(538) + m(572) + m(606) + m(640) + m(674) + m(708) + m(742) + m(776) + m(810) + m(844) + m(878) + m(912) + m(946) + m(980) + m(1014) + m(1048) + m(1082) + m(1116) + m(1150);
m(2) + m(36) + m(70) + m(104) + m(138) + m(172)+ m(206)+ m(240)+ m(274)+ m(308)+ m(342)+ m(376)+ m(410)+ m(444)+ m(478)+ m(512)+ m(546)+ m(580)+ m(614)+ m(648)+ m(682)+ m(716)+ m(750)+ m(784)+ m(818)+ m(852)+ m(886)+ m(920)+ m(954)+ m(988)+ m(1022)+ m(1056)+ m(1090)+ m(1124)];


A2= [...
0;
0;
0;
m(15) + m(49) + m(83) + m(117) + m(151) + m(185) + m(219) + m(253) + m(287) + m(321) + m(355) + m(389) + m(423) + m(457) + m(491) + m(525) + m(559) + m(593) + m(627) + m(661) + m(695) + m(729) + m(763) + m(797) + m(831) + m(865) + m(899) + m(933) + m(967) + m(1001) + m(1035) + m(1069) + m(1103) + m(1137);
m(23) + m(57) + m(91) + m(125) + m(159) + m(193) + m(227) + m(261) + m(295) + m(329) + m(363) + m(397) + m(431) + m(465) + m(499) + m(533) + m(567) + m(601) + m(635) + m(669) + m(703) + m(737) + m(771) + m(805) + m(839) + m(873) + m(907) + m(941) + m(975) + m(1009) + m(1043) + m(1077) + m(1111) + m(1145);
0;
m(6) + m(40) + m(74) + m(108) + m(142) + m(176) + m(210) + m(244) + m(278) + m(312) + m(346) + m(380) + m(414) + m(448) + m(482) + m(516) + m(550) + m(584) + m(618) + m(652) + m(686) + m(720) + m(754) + m(788) + m(822) + m(856) + m(890) + m(924) + m(958) + m(992) + m(1026) + m(1060) + m(1094) + m(1128);
0;
0;
2*m(17) + 2*m(51) + 2*m(85) + 2*m(119) + 2*m(153) + 2*m(187) + 2*m(221) + 2*m(255) + 2*m(289) + 2*m(323) + 2*m(357) + 2*m(391) + 2*m(425) + 2*m(459) + 2*m(493) + 2*m(527) + 2*m(561) + 2*m(595) + 2*m(629) + 2*m(663) + 2*m(697) + 2*m(731) + 2*m(765) + 2*m(799) + 2*m(833) + 2*m(867) + 2*m(901) + 2*m(935) + 2*m(969) + 2*m(1003) + 2*m(1037) + 2*m(1071) + 2*m(1105) + 2*m(1139);
2*m(24) + 2*m(58) + 2*m(92) + 2*m(126) + 2*m(160) + 2*m(194) + 2*m(228) + 2*m(262) + 2*m(296) + 2*m(330) + 2*m(364) + 2*m(398) + 2*m(432) + 2*m(466) + 2*m(500) + 2*m(534) + 2*m(568) + 2*m(602) + 2*m(636) + 2*m(670) + 2*m(704) + 2*m(738) + 2*m(772) + 2*m(806) + 2*m(840) + 2*m(874) + 2*m(908) + 2*m(942) + 2*m(976) + 2*m(1010) + 2*m(1044) + 2*m(1078) + 2*m(1112) + 2*m(1146);
2*m(32) + 2*m(66)+ 2*m(100)+ 2*m(134)+ 2*m(168)+ 2*m(202)+ 2*m(236)+ 2*m(270)+ 2*m(304)+ 2*m(338)+ 2*m(372)+ 2*m(406)+ 2*m(440)+ 2*m(474)+ 2*m(508)+ 2*m(542)+ 2*m(576)+ 2*m(610)+ 2*m(644)+ 2*m(678)+ 2*m(712)+ 2*m(746)+ 2*m(780 )+ 2*m(814)+ 2*m(848)+ 2*m(882)+ 2*m(916)+ 2*m(950)+ 2*m(984)+ 2*m(1018)+ 2*m(1052)+ 2*m(1086)+ 2*m(1120)+ 2*m(1154);
2*m(8)+ 2*m(42)+ 2*m(76)+ 2*m(110)+ 2*m(144)+ 2*m(178)+ 2*m(212)+ 2*m(246)+ 2*m(280)+ 2*m(314)+ 2*m(348)+ 2*m(382)+ 2*m(416)+ 2*m(450)+ 2*m(484)+ 2*m(518)+ 2*m(552)+ 2*m(586)+ 2*m(620)+ 2*m(654)+ 2*m(688)+ 2*m(722)+ 2*m(756)+ 2*m(790)+ 2*m(824)+ 2*m(858)+ 2*m(892)+ 2*m(926)+ 2*m(960)+ 2*m(994)+ 2*m(1028)+ 2*m(1062)+ 2*m(1096)+ 2*m(1130);
0;
0;
m(25) + m(59)+ m(93)+ m(127)+ m(161)+ m(195)+ m(229)+ m(263)+ m(297)+ m(331)+ m(365)+ m(399)+ m(433)+ m(467)+ m(501)+ m(535)+ m(569)+ m(603)+ m(637)+ m(671)+ m(705)+ m(739)+ m(773)+ m(807)+ m(841)+ m(875)+ m(909)+ m(943)+ m(977)+ m(1011)+ m(1045)+ m(1079)+ m(1113)+ m(1147);
m(33)+ m(67)+ m(101)+ m(135)+ m(169)+ m(203 )+ m(237)+ m(271)+ m(305)+ m(339)+ m(373)+ m(407)+ m(441)+ m(475)+ m(509)+ m(543)+ m(577)+ m(611)+ m(645)+ m(679)+ m(713)+ m(747)+ m(781)+ m(815)+ m(849)+ m(883)+ m(917)+ m(951)+ m(985)+ m(1019)+ m(1053 )+ m(1087)+ m(1121)+ m(1155);
m(9) + m(43)+ m(77)+ m(111)+ m(145)+ m(179)+ m(213)+ m(247)+ m(281)+ m(315)+ m(349)+ m(383)+ m(417)+ m(451)+ m(485)+ m(519)+ m(553)+ m(587)+ m(621)+ m(655)+ m(689)+ m(723)+ m(757)+ m(791)+ m(825)+ m(859)+ m(893)+ m(927)+ m(961)+ m(995)+ m(1029)+ m(1063)+ m(1097)+ m(1131);
m(12) + m(46)+ m(80)+ m(114)+ m(148)+ m(182)+ m(216 )+ m(250)+ m(284)+ m(318)+ m(352)+ m(386)+ m(420 )+ m(454)+ m(488)+ m(522)+ m(556)+ m(590)+ m(624)+ m(658)+ m(692)+ m(726)+ m(760)+ m(794)+ m(828)+ m(862)+ m(896)+ m(930)+ m(964)+ m(998)+ m(1032)+ m(1066)+ m(1100)+ m(1134);
0;
m(29)+ m(63)+ m(97)+ m(131)+ m(165)+ m(199)+ m(233)+ m(267)+ m(301)+ m(335)+ m(369)+ m(403)+ m(437 )+ m(471)+ m(505)+ m(539)+ m(573)+ m(607)+ m(641 )+ m(675)+ m(709)+ m(743)+ m(777)+ m(811)+ m(845)+ m(879)+ m(913)+ m(947)+ m(981)+ m(1015)+ m(1049)+ m(1083)+ m(1117)+ m(1151);
m(3)+ m(37)+ m(71)+ m(105)+ m(139)+ m(173)+ m(207)+ m(241)+ m(275)+ m(309)+ m(343)+ m(377)+ m(411)+ m(445)+ m(479)+ m(513)+ m(547)+ m(581)+ m(615)+ m(649)+ m(683)+ m(717)+ m(751)+ m(785)+ m(819)+ m(853)+ m(887)+ m(921)+ m(955)+ m(989)+ m(1023)+ m(1057)+ m(1091)+ m(1125)];

A3= [...
0;
0;
0;
m(16)+ m(50)+ m(84)+ m(118)+ m(152)+ m(186)+ m(220)+ m(254)+ m(288)+ m(322)+ m(356)+ m(390)+ m(424)+ m(458)+ m(492)+ m(526)+ m(560)+ m(594)+ m(628)+ m(662)+ m(696)+ m(730)+ m(764)+ m(798)+ m(832)+ m(866)+ m(900)+ m(934)+ m(968)+ m(1002)+ m(1036)+ m(1070)+ m(1104)+ m(1138);
0;
m(31)+ m(65)+ m(99)+ m(133)+ m(167)+ m(201)+ m(235)+ m(269)+ m(303)+ m(337)+ m(371)+ m(405)+ m(439)+ m(473)+ m(507)+ m(541)+ m(575)+ m(609)+ m(643)+ m(677)+ m(711)+ m(745)+ m(779)+ m(813)+ m(847)+ m(881)+ m(915)+ m(949)+ m(983)+ m(1017)+ m(1051)+ m(1085)+ m(1119)+ m(1153);
m(7)+ m(41)+ m(75)+ m(109)+ m(143)+ m(177)+ m(211)+ m(245)+ m(279)+ m(313)+ m(347)+ m(381)+ m(415)+ m(449)+ m(483)+ m(517)+ m(551)+ m(585)+ m(619)+ m(653)+ m(687)+ m(721)+ m(755)+ m(789)+ m(823 )+ m(857)+ m(891)+ m(925)+ m(959)+ m(993)+ m(1027)+ m(1061)+ m(1095)+ m(1129);
0;
0;
0;
m(25)+ m(59)+ m(93)+ m(127)+ m(161)+ m(195)+ m(229)+ m(263)+ m(297)+ m(331)+ m(365)+ m(399)+ m(433)+ m(467)+ m(501)+ m(535)+ m(569)+ m(603)+ m(637)+ m(671)+ m(705)+ m(739)+ m(773)+ m(807)+ m(841)+ m(875)+ m(909)+ m(943)+ m(977)+ m(1011)+ m(1045)+ m(1079)+ m(1113)+ m(1147);
m(33)+ m(67)+ m(101)+ m(135)+ m(169)+ m(203 )+ m(237)+ m(271)+ m(305)+ m(339)+ m(373 )+ m(407)+ m(441)+ m(475)+ m(509)+ m(543)+ m(577)+ m(611)+ m(645)+ m(679)+ m(713 )+ m(747)+ m(781)+ m(815)+ m(849)+ m(883)+ m(917)+ m(951)+ m(985)+ m(1019)+ m(1053 )+ m(1087)+ m(1121)+ m(1155);
m(9)+ m(43)+ m(77)+ m(111)+ m(145)+ m(179)+ m(213)+ m(247)+ m(281)+ m(315)+ m(349)+ m(383)+ m(417)+ m(451)+ m(485)+ m(519)+ m(553)+ m(587)+ m(621)+ m(655)+ m(689)+ m(723)+ m(757)+ m(791)+ m(825)+ m(859)+ m(893)+ m(927)+ m(961)+ m(995)+ m(1029)+ m(1063)+ m(1097)+ m(1131);
0;
2*m(18)+ 2*m(52)+ 2*m(86)+ 2*m(120)+ 2*m(154)+ 2*m(188)+ 2*m(222)+ 2*m(256)+ 2*m(290)+ 2*m(324)+ 2*m(358)+ 2*m(392)+ 2*m(426)+ 2*m(460)+ 2*m(494)+ 2*m(528)+ 2*m(562)+ 2*m(596)+ 2*m(630)+ 2*m(664)+ 2*m(698)+ 2*m(732)+ 2*m(766)+ 2*m(800)+ 2*m(834)+ 2*m(868)+ 2*m(902)+ 2*m(936)+ 2*m(970)+ 2*m(1004)+ 2*m(1038)+ 2*m(1072)+ 2*m(1106)+ 2*m(1140);
2*m(26)+ 2*m(60)+ 2*m(94)+ 2*m(128)+ 2*m(162)+ 2*m(196)+ 2*m(230)+ 2*m(264)+ 2*m(298)+ 2*m(332)+ 2*m(366)+ 2*m(400)+ 2*m(434 )+ 2*m(468)+ 2*m(502)+ 2*m(536)+ 2*m(570)+ 2*m(604)+ 2*m(638)+ 2*m(672)+ 2*m(706)+ 2*m(740)+ 2*m(774)+ 2*m(808)+ 2*m(842)+ 2*m(876)+ 2*m(910)+ 2*m(944)+ 2*m(978)+ 2*m(1012)+ 2*m(1046)+ 2*m(1080)+ 2*m(1114)+ 2*m(1148);
2*m(34)+ 2*m(68 )+ 2*m(102)+ 2*m(136)+ 2*m(170)+ 2*m(204)+ 2*m(238)+ 2*m(272)+ 2*m(306)+ 2*m(340)+ 2*m(374)+ 2*m(408)+ 2*m(442 )+ 2*m(476)+ 2*m(510)+ 2*m(544)+ 2*m(578)+ 2*m(612)+ 2*m(646)+ 2*m(680)+ 2*m(714)+ 2*m(748)+ 2*m(782)+ 2*m(816)+ 2*m(850)+ 2*m(884)+ 2*m(918)+ 2*m(952)+ 2*m(986)+ 2*m(1020)+ 2*m(1054)+ 2*m(1088)+ 2*m(1122)+ 2*m(1156);
2*m(10)+ 2*m(44)+ 2*m(78)+ 2*m(112)+ 2*m(146)+ 2*m(180)+ 2*m(214)+ 2*m(248)+ 2*m(282)+ 2*m(316)+ 2*m(350)+ 2*m(384)+ 2*m(418)+ 2*m(452)+ 2*m(486)+ 2*m(520)+ 2*m(554)+ 2*m(588)+ 2*m(622)+ 2*m(656)+ 2*m(690)+ 2*m(724)+ 2*m(758)+ 2*m(792)+ 2*m(826)+ 2*m(860)+ 2*m(894)+ 2*m(928)+ 2*m(962)+ 2*m(996)+ 2*m(1030)+ 2*m(1064)+ 2*m(1098)+ 2*m(1132);
m(13)+ m(47)+ m(81)+ m(115)+ m(149)+ m(183)+ m(217 )+ m(251)+ m(285)+ m(319)+ m(353)+ m(387)+ m(421 )+ m(455)+ m(489)+ m(523)+ m(557)+ m(591)+ m(625 )+ m(659)+ m(693)+ m(727)+ m(761)+ m(795)+ m(829)+ m(863)+ m(897)+ m(931)+ m(965)+ m(999)+ m(1033)+ m(1067)+ m(1101)+ m(1135);
m(21)+  m(55)+  m(89)+  m(123)+  m(157)+  m(191)+  m(225)+  m(259)+  m(293)+  m(327)+  m(361)+  m(395)+  m(429 )+  m(463)+  m(497)+  m(531)+  m(565)+  m(599)+  m(633 )+  m(667)+  m(701)+  m(735)+  m(769)+  m(803)+  m(837)+  m(871)+  m(905)+  m(939)+  m(973)+  m(1007)+  m(1041)+  m(1075)+  m(1109)+  m(1143);
0;
m(4)+ m(38)+ m(72)+ m(106)+ m(140)+ m(174)+ m(208)+ m(242)+ m(276)+ m(310)+ m(344)+ m(378)+ m(412)+ m(446)+ m(480)+ m(514)+ m(548)+ m(582)+ m(616)+ m(650)+ m(684)+ m(718)+ m(752)+ m(786)+ m(854)+ m(888)+ m(922)+ m(956)+ m(990)+ m(1024)+ m(1058)+ m(1092)+ m(1126)];

A4= [...
m(14)+ m(48)+ m(82 )+ m(116)+ m(150)+ m(184)+ m(218)+ m(252)+ m(286)+ m(320)+ m(354)+ m(388)+ m(422)+ m(456)+ m(490)+ m(524)+ m(558)+ m(592)+ m(626)+ m(660)+ m(694)+ m(728)+ m(762)+ m(796)+ m(830)+ m(864)+ m(898)+ m(932)+ m(966)+ m(1000)+ m(1034)+ m(1068)+ m(1102 )+ m(1136);
m(15)+ m(49)+ m(83)+ m(117)+ m(151)+ m(185)+ m(219)+ m(253)+ m(287)+ m(321)+ m(355)+ m(389)+ m(423)+ m(457)+ m(491)+ m(525)+ m(559)+ m(593)+ m(627)+ m(661)+ m(695)+ m(729)+ m(763)+ m(797)+ m(831)+ m(865)+ m(899)+ m(933)+ m(967)+ m(1001)+ m(1035)+ m(1069)+ m(1103)+ m(1137);
m(16)+ m(50)+ m(84)+ m(118)+ m(152)+ m(186)+ m(220)+ m(254)+ m(288)+ m(322)+ m(356)+ m(390)+ m(424)+ m(458)+ m(492)+ m(526)+ m(560)+ m(594)+ m(628)+ m(662)+ m(696)+ m(730)+ m(764)+ m(798)+ m(832)+ m(866)+ m(900)+ m(934)+ m(968)+ m(1002)+ m(1036)+ m(1070)+ m(1104)+ m(1138);
0;
0;
0;
0;
m(17)+ m(51)+ m(85)+ m(119)+ m(153)+ m(187)+ m(221)+ m(255)+ m(289)+ m(323)+ m(357)+ m(391)+ m(425 )+ m(459)+ m(493)+ m(527)+ m(561)+ m(595)+ m(629)+ m(663)+ m(697)+ m(731)+ m(765 )+ m(799)+ m(833)+ m(867)+ m(901)+ m(935)+ m(969)+ m(1003)+ m(1037)+ m(1071)+ m(1105)+ m(1139);
0;
0;
0;
0;
m(12)+ m(46)+ m(80)+ m(114)+ m(148)+ m(182)+ m(216)+ m(250)+ m(284)+ m(318)+ m(352)+ m(386)+ m(420)+ m(454)+ m(488)+ m(522)+ m(556)+ m(590)+ m(624)+ m(658)+ m(692)+ m(726)+ m(760)+ m(794)+ m(828)+ m(862)+ m(896)+ m(930)+ m(964)+ m(998)+ m(1032)+ m(1066)+ m(1100)+ m(1134);
m(18)+ m(52)+ m(86)+ m(120)+ m(154)+ m(188)+ m(222)+ m(256)+ m(290)+ m(324)+ m(358)+ m(392)+ m(426)+ m(460)+ m(494)+ m(528)+ m(562)+ m(596)+ m(630)+ m(664)+ m(698)+ m(732)+ m(766)+ m(800)+ m(834)+ m(868)+ m(902)+ m(936)+ m(970)+ m(1004)+ m(1038)+ m(1072)+ m(1106)+ m(1140);
0;
0;
0;
m(13)+ m(47)+ m(81)+ m(115)+ m(149)+ m(183)+ m(217)+ m(251)+ m(285)+ m(319)+ m(353)+ m(387)+ m(421)+ m(455)+ m(489)+ m(523)+ m(557)+ m(591)+ m(625)+ m(659)+ m(693)+ m(727)+ m(761)+ m(795)+ m(829)+ m(863)+ m(897)+ m(931)+ m(965)+ m(999)+ m(1033)+ m(1067)+ m(1101)+ m(1135);
0;
0;
0;
m(11)+ m(45)+ m(79)+ m(113)+ m(147)+ m(181)+ m(215)+ m(249)+ m(283)+ m(317)+ m(351)+ m(385)+ m(419)+ m(453)+ m(487)+ m(521)+ m(555)+ m(589)+ m(623)+ m(657)+ m(691)+ m(725)+ m(759)+ m(793)+ m(827)+ m(861)+ m(895)+ m(929)+ m(963)+ m(997)+ m(1031)+ m(1065)+ m(1099)+ m(1133)];

A5= [...
m(22)+ m(56)+ m(90)+ m(124)+ m(158)+ m(192)+ m(226)+ m(260)+ m(294)+ m(328)+ m(362)+ m(396)+ m(430)+ m(464)+ m(498)+ m(532)+ m(566)+ m(600)+ m(634)+ m(668)+ m(702)+ m(736)+ m(770)+ m(804)+ m(838)+ m(872)+ m(906)+ m(940)+ m(974)+ m(1008)+ m(1042)+ m(1076)+ m(1110)+ m(1144);
m(23)+ m(57)+ m(91)+ m(125)+ m(159)+ m(193)+ m(227)+ m(261)+ m(295)+ m(329)+ m(363)+ m(397)+ m(431)+ m(465)+ m(499)+ m(533)+ m(567)+ m(601)+ m(635)+ m(669)+ m(703)+ m(737)+ m(771)+ m(805)+ m(839)+ m(873)+ m(907)+ m(941)+ m(975)+ m(1009)+ m(1043)+ m(1077)+ m(1111)+ m(1145);
0;
0;
0;
0;
m(20)+ m(54)+ m(88)+ m(122)+ m(156)+ m(190)+ m(224)+ m(258)+ m(292)+ m(326)+ m(360)+ m(394)+ m(428 )+ m(462)+ m(496)+ m(530)+ m(564)+ m(598)+ m(632)+ m(666)+ m(700)+ m(734)+ m(768)+ m(802)+ m(836)+ m(870)+ m(904)+ m(938)+ m(972)+ m(1006)+ m(1040)+ m(1074)+ m(1108)+ m(1142);
m(24)+ m(58)+ m(92)+ m(126)+ m(160)+ m(194)+ m(228)+ m(262)+ m(296)+ m(330)+ m(364)+ m(398)+ m(432 )+ m(466)+ m(500)+ m(534)+ m(568)+ m(602)+ m(636)+ m(670)+ m(704)+ m(738)+ m(772 )+ m(806)+ m(840)+ m(874)+ m(908)+ m(942)+ m(976)+ m(1010)+ m(1044)+ m(1078)+ m(1112)+ m(1146);
m(25)+ m(59)+ m(93)+ m(127)+ m(161)+ m(195)+ m(229)+ m(263)+ m(297)+ m(331)+ m(365)+ m(399)+ m(433)+ m(467)+ m(501)+ m(535)+ m(569)+ m(603)+ m(637)+ m(671)+ m(705)+ m(739)+ m(773)+ m(807)+ m(841)+ m(875)+ m(909)+ m(943)+ m(977)+ m(1011)+ m(1045)+ m(1079)+ m(1113)+ m(1147);
0;
0;
0;
0;
m(26)+ m(60)+ m(94)+ m(128)+ m(162)+ m(196)+ m(230)+ m(264)+ m(298)+ m(332)+ m(366)+ m(400)+ m(434)+ m(468)+ m(502)+ m(536)+ m(570)+ m(604)+ m(638)+ m(672)+ m(706)+ m(740)+ m(774)+ m(808)+ m(842)+ m(876)+ m(910)+ m(944)+ m(978)+ m(1012)+ m(1046)+ m(1080)+ m(1114)+ m(1148);
0;
0;
0;
m(21)+ m(55)+ m(89)+ m(123)+ m(157)+ m(191)+ m(225)+ m(259)+ m(293)+ m(327)+ m(361)+ m(395)+ m(429)+ m(463)+ m(497)+ m(531)+ m(565)+ m(599)+ m(633)+ m(667)+ m(701)+ m(735)+ m(769)+ m(803)+ m(837)+ m(871)+ m(905)+ m(939)+ m(973)+ m(1007)+ m(1041)+ m(1075)+ m(1109)+ m(1143);
0;
0;
0;
m(19)+ m(53)+ m(87)+ m(121)+ m(155)+ m(189)+ m(223)+ m(257)+ m(291)+ m(325)+ m(359)+ m(393)+ m(427)+ m(461)+ m(495)+ m(529)+ m(563)+ m(597)+ m(631)+ m(665)+ m(699)+ m(733)+ m(767)+ m(801)+ m(835)+ m(869)+ m(903)+ m(937)+ m(971)+ m(1005)+ m(1039)+ m(1073)+ m(1107)+ m(1141)];

A6= [...
m(30)+ m(64)+ m(98)+ m(132)+ m(166)+ m(200)+ m(234)+ m(268)+ m(302)+ m(336)+ m(370)+ m(404)+ m(438 )+ m(472)+ m(506)+ m(540)+ m(574)+ m(608)+ m(642)+ m(676)+ m(710)+ m(744)+ m(778 )+ m(812)+ m(846)+ m(880)+ m(914)+ m(948)+ m(982)+ m(1016)+ m(1050)+ m(1084)+ m(1118 )+ m(1152);
0;
m(31)+ m(65)+ m(99)+ m(133)+ m(167)+ m(201)+ m(235)+ m(269)+ m(303)+ m(337)+ m(371)+ m(405)+ m(439)+ m(473)+ m(507)+ m(541)+ m(575)+ m(609)+ m(643)+ m(677)+ m(711)+ m(745)+ m(779)+ m(813)+ m(847)+ m(881)+ m(915)+ m(949)+ m(983)+ m(1017)+ m(1051)+ m(1085)+ m(1119)+ m(1153);
0;
0;
0;
m(28)+ m(62)+ m(96)+ m(130)+ m(164)+ m(198)+ m(232)+ m(266)+ m(300)+ m(334)+ m(368)+ m(402)+ m(436 )+ m(470)+ m(504)+ m(538)+ m(572)+ m(606)+ m(640)+ m(674)+ m(708)+ m(742)+ m(776)+ m(810)+ m(844)+ m(878)+ m(912)+ m(946)+ m(980)+ m(1014)+ m(1048)+ m(1082)+ m(1116)+ m(1150);
m(32)+ m(66)+ m(100)+ m(134)+ m(168)+ m(202)+ m(236)+ m(270)+ m(304)+ m(338)+ m(372)+ m(406)+ m(440)+ m(474)+ m(508)+ m(542)+ m(576)+ m(610)+ m(644)+ m(678)+ m(712)+ m(746)+ m(780)+ m(814)+ m(848)+ m(882)+ m(916)+ m(950)+ m(984)+ m(1018)+ m(1052)+ m(1086)+ m(1120)+ m(1154);
m(33)+ m(67)+ m(101)+ m(135)+ m(169)+ m(203)+ m(237)+ m(271)+ m(305)+ m(339)+ m(373)+ m(407)+ m(441)+ m(475)+ m(509)+ m(543)+ m(577)+ m(611)+ m(645)+ m(679)+ m(713)+ m(747)+ m(781)+ m(815)+ m(849)+ m(883)+ m(917)+ m(951)+ m(985)+ m(1019)+ m(1053 )+ m(1087)+ m(1121)+ m(1155);
0;
0;
0;
m(29)+ m(63 )+ m(97)+ m(131)+ m(165)+ m(199)+ m(233 )+ m(267)+ m(301)+ m(335)+ m(369)+ m(403)+ m(437)+ m(471)+ m(505)+ m(539)+ m(573)+ m(607)+ m(641)+ m(675)+ m(709)+ m(743)+ m(777)+ m(811)+ m(845)+ m(879)+ m(913)+ m(947)+ m(981)+ m(1015)+ m(1049)+ m(1083)+ m(1117)+ m(1151);
m(34)+ m(68)+ m(102)+ m(136)+ m(170)+ m(204)+ m(238)+ m(272)+ m(306)+ m(340)+ m(374)+ m(408)+ m(442)+ m(476)+ m(510)+ m(544)+ m(578)+ m(612)+ m(646)+ m(680)+ m(714)+ m(748)+ m(782)+ m(816)+ m(850)+ m(884)+ m(918)+ m(952)+ m(986)+ m(1020)+ m(1054)+ m(1088)+ m(1122)+ m(1156);
0;
0;
0;
0;
0;
0;
0;
m(27)+ m(61)+ m(95)+ m(129)+ m(163)+ m(197)+ m(231)+ m(265)+ m(299)+ m(333)+ m(367)+ m(401)+ m(435)+ m(469)+ m(503)+ m(537)+ m(571)+ m(605)+ m(639)+ m(673)+ m(707)+ m(741)+ m(775)+ m(809)+ m(843)+ m(877)+ m(911)+ m(945)+ m(979)+ m(1013)+ m(1047)+ m(1081)+ m(1115)+ m(1149)];

s= s0;

pref= 10000;

for i= 1:100
    
    s1= s(1);
    s2= s(2);
    s3= s(3);
    s4= s(4);
    s5= s(5);
    s6= s(6);

    vecs= [s1^2 , s1*s2 , s1*s3 , s1*s4 , s1*s5 , s1*s6 , s1 , s2^2 , s2*s3 , s2*s4 , s2*s5 , s2*s6 , s2 , s3^2 , s3*s4 , s3*s5 , s3*s6 , s3 , s4 , s5 , s6, 1];

    vecs1= [ 2*s1, s2, s3, s4, s5, s6, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    vecs2= [ 0, s1, 0, 0, 0, 0, 0, 2*s2, s3, s4, s5, s6, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    vecs3= [ 0, 0, s1, 0, 0, 0, 0, 0, s2, 0, 0, 0, 0, 2*s3, s4, s5, s6, 1, 0, 0, 0, 0];
    vecs4= [ 0, 0, 0, s1, 0, 0, 0, 0, 0, s2, 0, 0, 0, 0, s3, 0, 0, 0, 1, 0, 0, 0];
    vecs5= [ 0, 0, 0, 0, s1, 0, 0, 0, 0, 0, s2, 0, 0, 0, 0, s3, 0, 0, 0, 1, 0, 0];
    vecs6= [ 0, 0, 0, 0, 0, s1, 0, 0, 0, 0, 0, s2, 0, 0, 0, 0, s3, 0, 0, 0, 1, 0];

    f1= vecs*A1;
    f2= vecs*A2;
    f3= vecs*A3;
    f4= vecs*A4;
    f5= vecs*A5;
    f6= vecs*A6;

    curf= f1*f1+f2*f2+f3*f3+f4*f4+f5*f5+f6*f6;
    if curf > pref
	break;
    end

    pref= curf;

    f11= vecs1*A1;
    f12= vecs2*A1;
    f13= vecs3*A1;
    f14= vecs4*A1;
    f15= vecs5*A1;
    f16= vecs6*A1;

    f21= vecs1*A2;
    f22= vecs2*A2;
    f23= vecs3*A2;
    f24= vecs4*A2;
    f25= vecs5*A2;
    f26= vecs6*A2;

    f31= vecs1*A3;
    f32= vecs2*A3;
    f33= vecs3*A3;
    f34= vecs4*A3;
    f35= vecs5*A3;
    f36= vecs6*A3;
    
    f41= vecs1*A4;
    f42= vecs2*A4;
    f43= vecs3*A4;
    f44= vecs4*A4;
    f45= vecs5*A4;
    f46= vecs6*A4;
    
    f51= vecs1*A5;
    f52= vecs2*A5;
    f53= vecs3*A5;
    f54= vecs4*A5;
    f55= vecs5*A5;
    f56= vecs6*A5;
    
    f61= vecs1*A6;
    f62= vecs2*A6;
    f63= vecs3*A6;
    f64= vecs4*A6;
    f65= vecs5*A6;
    f66= vecs6*A6;
    
    

     H= [f11 f12 f13 f14 f15 f16; f21 f22 f23 f24 f25 f26; f31 f32 f33 f34 f35 f36; f41 f42 f43 f44 f45 f46; f51 f52 f53 f54 f55 f56; f61 f62 f63 f64 f65 f66];
    
    s= s- inv(H)*[f1; f2; f3; f4; f5; f6];
    
end
